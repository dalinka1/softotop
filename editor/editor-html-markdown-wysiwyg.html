<!DOCTYPE html>
<html>
<head>
    <title>Универсальный редактор html - markdown - bb code - wysiwyg</title>
  <link rel="stylesheet" href="/menu/menu.css">
  <script src="/menu/menu.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        .container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        .editor-pane, .preview-pane {
            width: 50%;
            padding: 20px;
            position: relative;
        }

        .resizer {
            width: 10px;
            background: #f0f0f0;
            cursor: col-resize;
            border-left: 1px solid #ccc;
            border-right: 1px solid #ccc;
            transition: background 0.3s;
        }

        .resizer:hover {
            background: #ddd;
        }

        #editor {
            width: 100%;
            height: 100%;
            padding: 15px;
            border: 2px solid #ccc;
            border-radius: 8px;
            resize: none;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        #preview {
            height: 100%;
            overflow-y: auto;
            padding: 15px;
            border: 2px solid #ccc;
            border-radius: 8px;
            background: #fff;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }

        /* Стили элементов предпросмотра */
        #preview h1 { font-size: 2em; margin: 0.67em 0; }
        #preview h2 { font-size: 1.5em; margin: 0.83em 0; }
        #preview blockquote {
            border-left: 4px solid #ddd;
            margin: 1em 0;
            padding: 0 1em;
            color: #666;
        }
        #preview pre {
            background: #f8f8f8;
            padding: 1em;
            border-radius: 4px;
            overflow: auto;
        }
        #preview table {
            border-collapse: collapse;
            margin: 1em 0;
            width: 100%;
        }
        #preview td, #preview th {
            border: 1px solid #ddd;
            padding: 8px;
        }
        #preview ul, #preview ol {
            padding-left: 2em;
            margin: 1em 0;
        }
        #preview li {
            margin: 0.5em 0;
        }
        #preview img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="editor-pane">
            <textarea id="editor" placeholder="Введите ваш код (HTML/Markdown)..."></textarea>
        </div>
        <div class="resizer"></div>
        <div class="preview-pane">
            <div id="preview"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script>
        // Инициализация элементов
        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview');
        const resizer = document.querySelector('.resizer');
        const container = document.querySelector('.container');

        // Изменение размера панелей
        let isResizing = false;
        
        resizer.addEventListener('mousedown', e => {
            isResizing = true;
            document.body.style.cursor = 'col-resize';
            e.preventDefault();
        });

        document.addEventListener('mousemove', e => {
            if (!isResizing) return;
            
            const containerRect = container.getBoundingClientRect();
            const mouseX = e.clientX - containerRect.left;
            const newWidth = (mouseX / containerRect.width) * 100;
            
            document.querySelector('.editor-pane').style.width = 
                `${Math.max(10, Math.min(90, newWidth))}%`;
            document.querySelector('.preview-pane').style.width = 
                `${100 - Math.max(10, Math.min(90, newWidth))}%`;
        });

        document.addEventListener('mouseup', () => {
            isResizing = false;
            document.body.style.cursor = 'default';
        });

        // Выделение текста
        editor.addEventListener('dblclick', function() {
            this.select();
        });

        preview.addEventListener('dblclick', function(e) {
            const selection = window.getSelection();
            const range = document.createRange();
            range.selectNodeContents(this);
            selection.removeAllRanges();
            selection.addRange(range);
        });

        // Обработка Ctrl+A в preview
        preview.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key.toLowerCase() === 'a') {
                e.preventDefault();
                const selection = window.getSelection();
                const range = document.createRange();
                range.selectNodeContents(this);
                selection.removeAllRanges();
                selection.addRange(range);
            }
        });

         function parseBBCode(text) {
    const replacements = {
        // Списки
        '\\[list\\]([\\s\\S]*?)\\[/list\\]': (_, content) => {
            const items = content.split(/\[\*\]\s*/g).filter(i => i.trim());
            return '<ul>' + items.map(i => `<li>${i.trim()}</li>`).join('') + '</ul>';
        },
        '\\[list=([1aAiI])\\]([\\s\\S]*?)\\[/list\\]': (_, type, content) => {
            const items = content.split(/\[\*\]\s*/g).filter(i => i.trim());
            return `<ol type="${type.toLowerCase()}">${items.map(i => `<li>${i.trim()}</li>`).join('')}</ol>`;
        },

        // Остальные замены
        '\\[table\\]([\\s\\S]*?)\\[/table\\]': (_, content) => {/* ... */},
        '\\[h([1-6])\\](.*?)\\[/h\\1\\]': '<h$1>$2</h$1>',
        '\\[b\\](.*?)\\[/b\\]': '<strong>$1</strong>',
        '\\[i\\](.*?)\\[/i\\]': '<em>$1</em>',
        '\\[u\\](.*?)\\[/u\\]': '<u>$1</u>',
        '\\[quote\\](.*?)\\[/quote\\]': '<blockquote>$1</blockquote>',
        '\\[code\\]([\\s\\S]*?)\\[/code\\]': '<pre><code>$1</code></pre>',
        '\\[url=([^\\]\\s]+)\\s*\\](.*?)\\[/url\\]': '<a href="$1">$2</a>',
        '\\[img\\]\\s*([^\\[\\]]+?)\\s*\\[/img\\]': '<img src="$1" alt="Image">'
    };

    let html = text;
    for (const [pattern, replacement] of Object.entries(replacements)) {
        const regex = new RegExp(pattern, 'gi');
        html = html.replace(regex, (...args) => 
            typeof replacement === 'function' 
                ? replacement(...args) 
                : args[0].replace(regex, replacement)
        );
    }
    return html;
}

function updatePreview() {
    let content = editor.value;
    
    // Сначала BB-код
    content = parseBBCode(content);
    
    // Затем Markdown
    content = marked.parse(content, {
        breaks: true,
        sanitize: false,
        gfm: true,
        tables: true
    });
    
    // Удаление горизонтальных линий
    content = content.replace(/<hr\s*\/?>/gi, '');
    
    preview.innerHTML = content;
}

        editor.addEventListener('input', updatePreview);
        window.addEventListener('load', updatePreview);
    </script>
</body>
</html>