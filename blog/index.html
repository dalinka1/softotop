<!DOCTYPE html>
<html lang="ru">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Blog Publishing System</title>
  <link rel="stylesheet" href="/menu/menu.css">
  <script src="/menu/menu.js" defer></script>
 <style>
 * { margin: 0; padding: 0; box-sizing: border-box; }
 body { 
 font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
 background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
 min-height: 100vh; padding: 20px;
 }
 .container { 
 max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; 
 box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden;
 }
 .header { 
 background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; 
 padding: 30px; text-align: center;
 }
 .header h1 { font-size: 2.5em; margin-bottom: 10px; }
 .header p { font-size: 1.1em; opacity: 0.9; }
 .form-container { padding: 40px; }
 .form-group { margin-bottom: 25px; }
 .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 1em; }
 .form-group input, .form-group textarea, .form-group select { 
 width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px; 
 font-size: 1em; transition: all 0.3s ease;
 }
 .form-group input:focus, .form-group textarea:focus, .form-group select:focus { 
 outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
 }
 .form-group small { display: block; margin-top: 5px; color: #666; font-size: 0.9em; }
 .editor-container { margin-bottom: 25px; }
 .editor-tabs { display: flex; gap: 10px; margin-bottom: 10px; border-bottom: 2px solid #e0e0e0; }
 .editor-tab { 
 padding: 10px 20px; background: none; border: none; cursor: pointer; font-size: 1em; 
 color: #666; border-bottom: 3px solid transparent; transition: all 0.3s ease;
 }
 .editor-tab.active { color: #667eea; border-bottom-color: #667eea; font-weight: 600; }
 .editor-tab:hover { color: #667eea; }
 .editor-mode { display: none; }
 .editor-mode.active { display: block; }
 .toolbar { 
 display: flex; gap: 5px; padding: 10px; background: #f5f5f5; border: 2px solid #e0e0e0; 
 border-bottom: none; border-radius: 8px 8px 0 0; flex-wrap: wrap;
 }
 .toolbar button { 
 padding: 8px 12px; background: white; border: 1px solid #ddd; border-radius: 4px; 
 cursor: pointer; font-size: 0.9em; transition: all 0.2s ease;
 }
 .toolbar button:hover { background: #667eea; color: white; border-color: #667eea; }
 #contentVisual { 
 min-height: 400px; padding: 20px; border: 2px solid #e0e0e0; border-radius: 0 0 8px 8px; 
 background: white; overflow-y: auto; max-height: 600px;
 }
 #contentVisual:focus { outline: none; border-color: #667eea; }
 #contentCode, #contentMarkdown, #contentBBCode { 
 width: 100%; min-height: 400px; padding: 20px; border: 2px solid #e0e0e0; 
 border-radius: 8px; font-family: 'Courier New', monospace; font-size: 0.95em; 
 resize: vertical;
 }
 .preview-container { margin-top: 20px; padding: 20px; background: #f9f9f9; border-radius: 8px; border: 2px solid #e0e0e0; }
 .preview-container h3 { margin-bottom: 15px; color: #333; }
 #preview { padding: 20px; background: white; border-radius: 8px; min-height: 200px; }
 
 /* ✅ СУПЕР УЛУЧШЕННЫЕ СТИЛИ ДЛЯ ИЗОБРАЖЕНИЙ */
 #preview img, #contentVisual img { 
   max-width: 100%; 
   height: auto; 
   border-radius: 20px; 
   margin: 35px auto;
   display: block;
   box-shadow: 0 15px 50px rgba(0,0,0,0.2);
   transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
   cursor: pointer;
   border: 4px solid transparent;
   animation: imageAppear 0.6s ease-out;
 }
 @keyframes imageAppear {
   from { opacity: 0; transform: scale(0.9) translateY(20px); }
   to { opacity: 1; transform: scale(1) translateY(0); }
 }
 #preview img:hover, #contentVisual img:hover { 
   transform: scale(1.05) translateY(-8px) rotate(1deg);
   box-shadow: 0 25px 70px rgba(102, 126, 234, 0.4);
   border-color: #667eea;
 }
 
 /* ✅ GIF СПЕЦИАЛЬНЫЙ ЭФФЕКТ */
 #preview img[src$=".gif"], #contentVisual img[src$=".gif"],
 #preview img[src*=".gif?"], #contentVisual img[src*=".gif?"] {
   border: 5px solid;
   border-image: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #667eea) 1;
   box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4), 0 0 30px rgba(118, 75, 162, 0.3);
   animation: gifGlow 2s ease-in-out infinite, imageAppear 0.6s ease-out;
 }
 @keyframes gifGlow {
   0%, 100% { filter: brightness(1) saturate(1); }
   50% { filter: brightness(1.1) saturate(1.2); }
 }
 
 /* ✅ СУПЕР УЛУЧШЕННЫЕ СТИЛИ ДЛЯ ВИДЕО */
 .video-wrapper {
   width: 900px;
   max-width: 100%;
   margin: 40px auto;
   border-radius: 20px;
   box-shadow: 0 20px 60px rgba(0,0,0,0.3);
   overflow: hidden;
   position: relative;
   transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
   background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
   padding: 6px;
   animation: videoAppear 0.8s ease-out;
 }
 @keyframes videoAppear {
   from { opacity: 0; transform: scale(0.95) translateY(30px); }
   to { opacity: 1; transform: scale(1) translateY(0); }
 }
 .video-wrapper::after {
   content: "";
   position: absolute;
   top: -50%;
   left: -50%;
   width: 200%;
   height: 200%;
   background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
   transform: rotate(45deg);
   transition: all 0.6s ease;
 }
 .video-wrapper:hover {
   transform: translateY(-10px) scale(1.02);
   box-shadow: 0 30px 80px rgba(102, 126, 234, 0.5);
 }
 .video-wrapper:hover::after {
   left: 100%;
 }
 .video-wrapper::before {
   content: "▶";
   position: absolute;
   top: 50%;
   left: 50%;
   transform: translate(-50%, -50%);
   font-size: 5em;
   color: rgba(255,255,255,0.9);
   z-index: 1;
   pointer-events: none;
   opacity: 0;
   transition: opacity 0.4s ease;
   text-shadow: 0 4px 15px rgba(0,0,0,0.3);
 }
 .video-wrapper:hover::before {
   opacity: 0.4;
   animation: playPulse 1.5s ease-in-out infinite;
 }
 @keyframes playPulse {
   0%, 100% { transform: translate(-50%, -50%) scale(1); }
   50% { transform: translate(-50%, -50%) scale(1.1); }
 }
 .video-wrapper iframe {
   width: 100%;
   height: 500px;
   border: none;
   border-radius: 16px;
   background: #000;
   display: block;
   position: relative;
   z-index: 2;
 }
 
 /* ✅ СУПЕР КРАСИВЫЕ ЗАГОЛОВКИ H1 - ГРАДИЕНТНЫЙ БЛОК */
 #preview h1, #contentVisual h1 {
   font-size: 2.4em;
   margin: 30px 0 20px;
   position: relative;
   padding: 25px 30px;
   background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
   color: white;
   border-radius: 15px;
   box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
   animation: gradientFlow 8s ease infinite;
   background-size: 200% 200%;
   text-shadow: 0 2px 10px rgba(0,0,0,0.2);
   font-weight: 700;
   letter-spacing: -0.5px;
 }
 #preview h1::before, #contentVisual h1::before {
   content: "";
   position: absolute;
   top: 0; left: 0; right: 0; bottom: 0;
   background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
   border-radius: 15px;
   animation: shimmer 3s ease-in-out infinite;
 }
 @keyframes gradientFlow {
   0%, 100% { background-position: 0% 50%; }
   50% { background-position: 100% 50%; }
 }
 @keyframes shimmer {
   0%, 100% { transform: translateX(-100%); }
   50% { transform: translateX(100%); }
 }
 
 /* ✅ СУПЕР КРАСИВЫЕ ЗАГОЛОВКИ H2 - БЕЗ СТРЕЛКИ */
 #preview h2, #contentVisual h2 {
   font-size: 1.9em;
   color: #333;
   margin: 25px 0 15px;
   padding: 15px 25px;
   position: relative;
   background: linear-gradient(120deg, rgba(102,126,234,0.05) 0%, rgba(118,75,162,0.05) 100%);
   border-left: 5px solid #667eea;
   border-radius: 0 10px 10px 0;
   transition: all 0.3s ease;
   font-weight: 600;
 }
 #preview h2::after, #contentVisual h2::after {
   content: "";
   position: absolute;
   bottom: 0;
   left: 0;
   width: 0;
   height: 3px;
   background: linear-gradient(90deg, #667eea, #764ba2);
   transition: width 0.4s ease;
 }
 #preview h2:hover, #contentVisual h2:hover {
   transform: translateX(5px);
   background: linear-gradient(120deg, rgba(102,126,234,0.1) 0%, rgba(118,75,162,0.1) 100%);
   box-shadow: 0 8px 20px rgba(102,126,234,0.15);
 }
 #preview h2:hover::after, #contentVisual h2:hover::after {
   width: 100%;
 }
 
 /* ✅ СУПЕР КРАСИВЫЕ ЗАГОЛОВКИ H3 - С ИКОНКОЙ */
 #preview h3, #contentVisual h3 {
   font-size: 1.6em;
   color: #444;
   margin: 20px 0 12px;
   padding: 15px 25px 15px 60px;
   background: white;
   border-radius: 10px;
   box-shadow: 0 5px 20px rgba(0,0,0,0.08);
   transition: all 0.3s ease;
   font-weight: 600;
   position: relative;
 }
 #preview h3::before, #contentVisual h3::before {
   content: "◆";
   position: absolute;
   left: 20px;
   top: 50%;
   transform: translateY(-50%);
   width: 30px;
   height: 30px;
   background: linear-gradient(135deg, #667eea, #764ba2);
   border-radius: 8px;
   display: flex;
   align-items: center;
   justify-content: center;
   color: white;
   font-size: 0.6em;
   box-shadow: 0 4px 12px rgba(102,126,234,0.3);
 }
 #preview h3:hover, #contentVisual h3:hover {
   transform: translateY(-3px);
   box-shadow: 0 10px 30px rgba(102,126,234,0.2);
 }
 
 /* ✅ СУПЕР КРАСИВЫЕ ЗАГОЛОВКИ H4 - РАМКА */
 #preview h4, #contentVisual h4 {
   font-size: 1.4em;
   color: #333;
   margin: 18px 0 10px;
   padding: 15px 25px;
   position: relative;
   border: 2px solid transparent;
   border-radius: 10px;
   background: 
     linear-gradient(white, white) padding-box,
     linear-gradient(135deg, #667eea, #764ba2) border-box;
   box-shadow: 0 4px 15px rgba(0,0,0,0.08);
   transition: all 0.3s ease;
   font-weight: 600;
 }
 #preview h4:hover, #contentVisual h4:hover {
   transform: scale(1.02);
   box-shadow: 0 8px 25px rgba(102,126,234,0.2);
 }
 
 /* ✅ СУПЕР КРАСИВЫЕ ЗАГОЛОВКИ H5 - ПОДЧЕРКНУТЫЙ */
 #preview h5, #contentVisual h5 {
   font-size: 1.2em;
   color: #667eea;
   margin: 15px 0 10px;
   padding: 10px 0;
   position: relative;
   font-weight: 600;
   border-bottom: 3px solid transparent;
   border-image: linear-gradient(90deg, #667eea, #764ba2, transparent) 1;
   transition: all 0.3s ease;
 }
 #preview h5::before, #contentVisual h5::before {
   content: "✦";
   margin-right: 10px;
   color: #764ba2;
   animation: rotate360 3s linear infinite;
   display: inline-block;
 }
 @keyframes rotate360 {
   from { transform: rotate(0deg); }
   to { transform: rotate(360deg); }
 }
 #preview h5:hover, #contentVisual h5:hover {
   color: #764ba2;
   padding-left: 10px;
 }
 
 /* ✅ СТИЛЬНЫЕ ТАБЛИЦЫ */
 #preview table, #contentVisual table { 
   border-collapse: collapse; width: 100%; margin: 25px 0; 
   background: white; border-radius: 12px; overflow: hidden; 
   box-shadow: 0 10px 30px rgba(0,0,0,0.15);
   animation: tableSlide 0.6s ease-out;
 }
 @keyframes tableSlide {
   from { transform: translateY(20px); opacity: 0; }
   to { transform: translateY(0); opacity: 1; }
 }
 #preview th, #contentVisual th { 
   background: linear-gradient(135deg, #667eea, #764ba2);
   color: white; padding: 16px 20px; font-weight: 600; text-align: left;
   text-transform: uppercase; font-size: 0.9em; letter-spacing: 1px;
 }
 #preview td, #contentVisual td { 
   padding: 14px 20px; border-bottom: 1px solid #e9ecef;
   transition: all 0.2s ease;
 }
 #preview tr:nth-child(even), #contentVisual tr:nth-child(even) { 
   background: #f8f9ff;
 }
 #preview tr:hover, #contentVisual tr:hover { 
   background: linear-gradient(90deg, #e3f2fd, #f0f4ff);
   transform: scale(1.01);
 }
 
 /* ✅ НОВЫЙ ДИЗАЙН ЦИТАТ - СИНИЙ СТИЛЬ */
 #preview blockquote, #contentVisual blockquote { 
   background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
   border-left: 0;
   padding: 30px 35px 30px 80px;
   margin: 35px 0;
   border-radius: 15px;
   font-style: italic;
   color: #1565c0;
   position: relative;
   box-shadow: 0 10px 35px rgba(33, 150, 243, 0.2);
   animation: quoteBreathe 4s ease-in-out infinite;
   font-size: 1.05em;
   line-height: 1.8;
 }
 @keyframes quoteBreathe {
   0%, 100% { transform: translateY(0px); box-shadow: 0 10px 35px rgba(33, 150, 243, 0.2); }
   50% { transform: translateY(-3px); box-shadow: 0 15px 45px rgba(33, 150, 243, 0.3); }
 }
 #preview blockquote::before, #contentVisual blockquote::before { 
   content: """;
   font-size: 6em;
   position: absolute;
   left: 15px;
   top: 10px;
   color: #42a5f5;
   opacity: 0.4;
   font-family: Georgia, serif;
   line-height: 1;
   font-weight: bold;
   text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
 }
 #preview blockquote::after, #contentVisual blockquote::after {
   content: "";
   position: absolute;
   top: 15px;
   right: 15px;
   width: 50px;
   height: 50px;
   background: linear-gradient(135deg, #42a5f5, #2196f3);
   border-radius: 50%;
   opacity: 0.15;
 }
 
 .publish-btn, .new-post-btn { 
 padding: 15px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
 color: white; border: none; border-radius: 8px; font-size: 1.2em; font-weight: 600; 
 cursor: pointer; transition: all 0.3s ease; margin: 10px 5px; display: inline-block;
 }
 .publish-btn:hover, .new-post-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3); }
 .publish-btn:active, .new-post-btn:active { transform: translateY(0); }
 .btn-group { text-align: center; margin-top: 20px; }
 .success-message, .error-message { padding: 15px; border-radius: 8px; margin-top: 20px; display: none; }
 .success-message { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
 .error-message { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
 .success-message.show, .error-message.show { display: block; }
 .file-url { margin-top: 10px; padding: 10px; background: #e7f3ff; border-radius: 4px; word-break: break-all; }
 .file-url a { color: #667eea; text-decoration: none; font-weight: 600; }
 .file-url a:hover { text-decoration: underline; }
 
 @media (max-width: 768px) {
   .video-wrapper iframe { height: 300px; }
 }
 </style>
</head>
<body>
 <div class="container">
 <div class="header">
 <h1>📝 Blog Publishing System</h1>
 <p>Create beautiful articles with visual editor</p>
 </div>
 
 <div class="form-container">
 <form id="blogForm">
 <div class="form-group">
 <label for="language">🌐 Language *</label>
 <select id="language" name="language" required>
 <option value="">Select language</option>
 <option value="ru">🇷🇺 Русский</option>
 <option value="en">🇬🇧 English</option>
 <option value="es">🇪🇸 Español</option>
 <option value="de">🇩🇪 Deutsch</option>
 <option value="fr">🇫🇷 Français</option>
 <option value="it">🇮🇹 Italiano</option>
 <option value="pl">🇵🇱 Polski</option>
 </select>
 <small>Article language</small>
 </div>
 
 <div class="form-group">
 <label for="author">👤 Author *</label>
 <input type="text" id="author" name="author" required placeholder="Автор блога">
 <small>Article author name (auto-saved)</small>
 </div>
 
 <div class="form-group">
 <label for="title">📌 Title *</label>
 <input type="text" id="title" name="title" required placeholder="My First Article">
 <small>Main article title</small>
 </div>
 
 <div class="form-group">
 <label for="slug">🔗 Page URL</label>
 <input type="text" id="slug" name="slug" placeholder="Auto-generated">
 <small><strong>Автоматически транслитерируется из Title</strong></small>
 </div>
 
 <div class="form-group">
 <label for="description">📄 Description *</label>
 <textarea id="description" name="description" rows="3" required placeholder="Brief article description..."></textarea>
 <small>SEO description, 150-160 characters</small>
 </div>
 
 <div class="editor-container">
 <label>✏️ Article Content *</label>
 <div class="editor-tabs">
 <button type="button" class="editor-tab active" data-tab="visual">Visual</button>
 <button type="button" class="editor-tab" data-tab="html">HTML</button>
 <button type="button" class="editor-tab" data-tab="markdown">Markdown</button>
 <button type="button" class="editor-tab" data-tab="bbcode">BBCode</button>
 </div>
 
 <div id="visualMode" class="editor-mode active">
 <div class="toolbar">
 <button type="button" onclick="execCmd('bold')"><b>B</b></button>
 <button type="button" onclick="execCmd('italic')"><i>I</i></button>
 <button type="button" onclick="execCmd('underline')"><u>U</u></button>
 <button type="button" onclick="execCmd('strikeThrough')"><s>S</s></button>
 <button type="button" onclick="execCmd('formatBlock', 'h1')">H1</button>
 <button type="button" onclick="execCmd('formatBlock', 'h2')">H2</button>
 <button type="button" onclick="execCmd('formatBlock', 'h3')">H3</button>
 <button type="button" onclick="execCmd('formatBlock', 'p')">P</button>
 <button type="button" onclick="execCmd('insertUnorderedList')">• List</button>
 <button type="button" onclick="execCmd('insertOrderedList')">1. List</button>
 <button type="button" onclick="insertTable()">📊 Table</button>
 <button type="button" onclick="insertQuote()">💬 Quote</button>
 <button type="button" onclick="insertLink()">🔗 Link</button>
 <button type="button" onclick="insertImage()">🖼️ Image</button>
 <button type="button" onclick="insertVideo()">🎥 Video</button>
 <button type="button" onclick="execCmd('justifyLeft')">⬅️</button>
 <button type="button" onclick="execCmd('justifyCenter')">↔️</button>
 <button type="button" onclick="execCmd('justifyRight')">➡️</button>
 <button type="button" onclick="execCmd('removeFormat')">🧹 Clear</button>
 </div>
 <div id="contentVisual" contenteditable="true"></div>
 </div>
 
 <div id="htmlMode" class="editor-mode">
 <textarea id="contentCode"></textarea>
 </div>
 
 <div id="markdownMode" class="editor-mode">
 <textarea id="contentMarkdown"></textarea>
 </div>
 
 <div id="bbcodeMode" class="editor-mode">
 <textarea id="contentBBCode"></textarea>
 </div>
 
 <div class="preview-container">
 <h3>👁️ Preview:</h3>
 <div id="preview"></div>
 </div>
 </div>
 
<div class="btn-group">
 <button type="submit" class="publish-btn">🚀 Publish</button>
 <button type="button" class="new-post-btn" onclick="newPost()">➕ New Post</button>
 <a href="/blog/blogs.php" class="new-post-btn" style="text-decoration: none; display: inline-block;">📚 Читать блоги / Read Blogs</a>
</div>
 
 <div id="successMessage" class="success-message">
 <strong>✅ Success!</strong> Article published successfully!
 <div class="file-url"></div>
 </div>
 
 <div id="errorMessage" class="error-message">
 <strong>❌ Error!</strong> <span id="errorText"></span>
 </div>
 </form>
 </div>
 </div>
 
 <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
 <script>
 // ✅ ЗАГРУЗКА СОХРАНЕННОГО ИМЕНИ АВТОРА ПРИ ЗАГРУЗКЕ СТРАНИЦЫ
 window.addEventListener('DOMContentLoaded', function() {
   const savedAuthor = localStorage.getItem('blog_author');
   if (savedAuthor) {
     document.getElementById('author').value = savedAuthor;
   }
 });

 // ✅ СОХРАНЕНИЕ ИМЕНИ АВТОРА В LOCALSTORAGE
 document.getElementById('author').addEventListener('change', function() {
   const authorName = this.value.trim();
   if (authorName) {
     localStorage.setItem('blog_author', authorName);
   }
 });

 // ✅ ТРАНСЛИТЕРАЦИЯ КИРИЛЛИЦЫ В ЛАТИНИЦУ
 function transliterate(text) {
   const translitMap = {
     'а': 'a', 'б': 'b', 'в': 'v', 'г': 'g', 'д': 'd',
     'е': 'e', 'ё': 'yo', 'ж': 'zh', 'з': 'z', 'и': 'i',
     'й': 'y', 'к': 'k', 'л': 'l', 'м': 'm', 'н': 'n',
     'о': 'o', 'п': 'p', 'р': 'r', 'с': 's', 'т': 't',
     'у': 'u', 'ф': 'f', 'х': 'h', 'ц': 'ts', 'ч': 'ch',
     'ш': 'sh', 'щ': 'sch', 'ъ': '', 'ы': 'y', 'ь': '',
     'э': 'e', 'ю': 'yu', 'я': 'ya',
     ' ': '-', '_': '-'
   };
   
   let result = '';
   for (let char of text.toLowerCase()) {
     result += translitMap[char] || char;
   }
   
   return result;
 }

 // ✅ AUTO-GENERATE SLUG FROM TITLE С ТРАНСЛИТЕРАЦИЕЙ
 document.getElementById('title').addEventListener('input', function() {
   const title = this.value.trim();
   document.getElementById('slug').value = generateSlug(title);
 });

 function generateSlug(title) {
   if (!title) return '';
   
   // Транслитерируем кириллицу
   let slug = transliterate(title);
   
   // Убираем все кроме букв, цифр, дефисов
   slug = slug.replace(/[^a-z0-9-]/g, '-');
   
   // Убираем повторяющиеся дефисы
   slug = slug.replace(/-+/g, '-');
   
   // Убираем дефисы в начале и конце
   slug = slug.replace(/^-|-$/g, '');
   
   return slug;
 }

 // ✅ НОВАЯ КНОПКА - ОЧИСТИТЬ ФОРМУ
 function newPost() {
   // Сохраняем имя автора перед очисткой
   const savedAuthor = document.getElementById('author').value;
   
   document.getElementById('blogForm').reset();
   document.getElementById('contentVisual').innerHTML = '';
   document.getElementById('contentCode').value = '';
   document.getElementById('contentMarkdown').value = '';
   document.getElementById('contentBBCode').value = '';
   
   // Восстанавливаем имя автора
   document.getElementById('author').value = savedAuthor;
   
   updatePreview();
   document.querySelector('.success-message').classList.remove('show');
   document.querySelector('.error-message').classList.remove('show');
 }

 // EDITOR TABS
 document.querySelectorAll('.editor-tab').forEach(tab => {
 tab.addEventListener('click', function() {
 const targetTab = this.dataset.tab;
 syncContent();
 document.querySelectorAll('.editor-tab').forEach(t => t.classList.remove('active'));
 this.classList.add('active');
 document.querySelectorAll('.editor-mode').forEach(mode => mode.classList.remove('active'));
 document.getElementById(targetTab + 'Mode').classList.add('active');
 updatePreview();
 });
 });
 
 function execCmd(command, value = null) {
 document.execCommand(command, false, value);
 updatePreview();
 }
 
 // ✅ ТАБЛИЦА
 function insertTable() {
 const tableHtml = `
 <table>
 <thead>
 <tr><th>Column 1</th><th>Column 2</th></tr>
 </thead>
 <tbody>
 <tr><td>Row 1</td><td>Data</td></tr>
 <tr><td>Row 2</td><td>Data</td></tr>
 </tbody>
 </table>
 `;
 document.execCommand('insertHTML', false, tableHtml);
 updatePreview();
 }
 
 // ✅ ЦИТАТА
 function insertQuote() {
 const quoteHtml = '<blockquote>Enter your quote here...</blockquote>';
 document.execCommand('insertHTML', false, quoteHtml);
 updatePreview();
 }
 
 function insertLink() {
 const url = prompt('Enter URL:');
 if (url) execCmd('createLink', url);
 }
 
 function insertImage() {
 const url = prompt('Enter image URL:');
 if (url) {
   document.execCommand('insertHTML', false, `<img src="${url}" alt="Image">`);
   updatePreview();
 }
 }
 
 // ✅ НОВАЯ ФУНКЦИЯ - ВСТАВКА ВИДЕО
 function insertVideo() {
 const url = prompt('Enter video URL (YouTube, Vimeo, Dailymotion, Rutube, TikTok, VK):');
 if (url) {
 const embedCode = convertVideoUrlToEmbed(url);
 if (embedCode) {
 document.execCommand('insertHTML', false, embedCode);
 updatePreview();
 } else {
 alert('Unsupported video URL format');
 }
 }
 }
 
 // ✅ РАСШИРЕННАЯ ФУНКЦИЯ КОНВЕРТАЦИИ ВИДЕО-ССЫЛОК В EMBED
 function convertVideoUrlToEmbed(url) {
   let match;
   
   // YouTube - поддержка различных форматов
   match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/shorts\/)([a-zA-Z0-9_-]{11})/);
   if (match) {
     return `<div class="video-wrapper"><iframe src="https://www.youtube.com/embed/${match[1]}" allowfullscreen></iframe></div>`;
   }
   
   // Vimeo
   match = url.match(/vimeo\.com\/(\d+)/);
   if (match) {
     return `<div class="video-wrapper"><iframe src="https://player.vimeo.com/video/${match[1]}" allowfullscreen></iframe></div>`;
   }
   
   // Dailymotion
   match = url.match(/dailymotion\.com\/video\/([a-zA-Z0-9]+)/);
   if (match) {
     return `<div class="video-wrapper"><iframe src="https://www.dailymotion.com/embed/video/${match[1]}" allowfullscreen></iframe></div>`;
   }
   
   // Rutube
   match = url.match(/rutube\.ru\/video\/([a-zA-Z0-9]+)/);
   if (match) {
     return `<div class="video-wrapper"><iframe src="https://rutube.ru/play/embed/${match[1]}" allowfullscreen></iframe></div>`;
   }
   
   // TikTok
   match = url.match(/tiktok\.com\/@[\w.-]+\/video\/(\d+)/);
   if (match) {
     return `<div class="video-wrapper"><iframe src="https://www.tiktok.com/embed/v2/${match[1]}" allowfullscreen></iframe></div>`;
   }
   
   // VK Video
   match = url.match(/vk\.com\/video(-?\d+_\d+)/);
   if (match) {
     return `<div class="video-wrapper"><iframe src="https://vk.com/video_ext.php?oid=${match[1].split('_')[0]}&id=${match[1].split('_')[1]}" allowfullscreen></iframe></div>`;
   }
   
   // Twitch
   match = url.match(/twitch\.tv\/videos\/(\d+)/);
   if (match) {
     return `<div class="video-wrapper"><iframe src="https://player.twitch.tv/?video=${match[1]}&parent=${window.location.hostname}" allowfullscreen></iframe></div>`;
   }

   // Bilibili
   match = url.match(/bilibili\.com\/video\/(BV[\w]+)/);
   if (match) {
     return `<div class="video-wrapper"><iframe src="https://player.bilibili.com/player.html?bvid=${match[1]}" allowfullscreen></iframe></div>`;
   }

   // Odysee
   match = url.match(/odysee\.com\/@([^:]+):[\w]+\/([^:]+):[\w]+/);
   if (match) {
     return `<div class="video-wrapper"><iframe src="https://odysee.com/$/embed/${match[2]}/${match[1]}" allowfullscreen></iframe></div>`;
   }
   
   return null;
 }
 
 // ✅ АВТОМАТИЧЕСКОЕ ПРЕОБРАЗОВАНИЕ ССЫЛОК ПРИ ВСТАВКЕ
 document.getElementById('contentVisual').addEventListener('paste', function(e) {
   const pastedText = (e.clipboardData || window.clipboardData).getData('text');
   
   // Проверяем, является ли вставленный текст ссылкой
   if (isUrl(pastedText)) {
     e.preventDefault();
     
     // Проверяем, является ли это видео
     const embedCode = convertVideoUrlToEmbed(pastedText);
     if (embedCode) {
       document.execCommand('insertHTML', false, embedCode);
       updatePreview();
       return;
     }
     
     // Проверяем, является ли это изображением
     if (isImageUrl(pastedText)) {
       document.execCommand('insertHTML', false, `<img src="${pastedText}" alt="Image">`);
       updatePreview();
       return;
     }
     
     // Обычная ссылка
     document.execCommand('insertHTML', false, `<a href="${pastedText}" target="_blank">${pastedText}</a>`);
     updatePreview();
   }
 });
 
 // ✅ ПРОВЕРКА, ЯВЛЯЕТСЯ ЛИ СТРОКА URL
 function isUrl(string) {
   try {
     const url = new URL(string);
     return url.protocol === 'http:' || url.protocol === 'https:';
   } catch (_) {
     return false;
   }
 }
 
 // ✅ АВТОМАТИЧЕСКОЕ ПРЕОБРАЗОВАНИЕ ССЫЛОК ПРИ ВСТАВКЕ (ГЛАВНАЯ ФИЧА!)
 document.getElementById('contentVisual').addEventListener('paste', function(e) {
   // Получаем HTML из буфера обмена
   const html = (e.clipboardData || window.clipboardData).getData('text/html');
   const plainText = (e.clipboardData || window.clipboardData).getData('text/plain');
   
   // Если есть HTML, пропускаем автопреобразование
   if (html && html.includes('<')) {
     return;
   }
   
   // Работаем только с обычным текстом
   const lines = plainText.split('\n');
   let hasMedia = false;
   let processedHtml = '';
   
   lines.forEach(line => {
     const trimmedLine = line.trim();
     
     if (trimmedLine && isUrl(trimmedLine)) {
       // Проверяем, является ли это видео
       const embedCode = convertVideoUrlToEmbed(trimmedLine);
       if (embedCode) {
         processedHtml += embedCode;
         hasMedia = true;
         return;
       }
       
       // Проверяем, является ли это изображением
       if (isImageUrl(trimmedLine)) {
         processedHtml += `<img src="${trimmedLine}" alt="Image">`;
         hasMedia = true;
         return;
       }
       
       // Обычная ссылка
       processedHtml += `<p><a href="${trimmedLine}" target="_blank">${trimmedLine}</a></p>`;
     } else if (trimmedLine) {
       // Обычный текст
       processedHtml += `<p>${trimmedLine}</p>`;
     }
   });
   
   if (hasMedia || processedHtml) {
     e.preventDefault();
     document.execCommand('insertHTML', false, processedHtml);
     updatePreview();
   }
 });
 
 // ✅ ПРОВЕРКА, ЯВЛЯЕТСЯ ЛИ СТРОКА URL
 function isUrl(string) {
   try {
     const url = new URL(string);
     return url.protocol === 'http:' || url.protocol === 'https:';
   } catch (_) {
     return false;
   }
 }
 
 // ✅ РАСШИРЕННАЯ ПРОВЕРКА, ЯВЛЯЕТСЯ ЛИ URL ИЗОБРАЖЕНИЕМ
 function isImageUrl(url) {
   return /\.(jpg|jpeg|png|gif|webp|bmp|svg|jfif|ico)(\?.*)?$/i.test(url) || 
          url.includes('postimg.cc') || 
          url.includes('imgur.com') || 
          url.includes('ibb.co') ||
          url.includes('i.postimg.cc');
 }
 
 function syncContent() {
 const activeTab = document.querySelector('.editor-tab.active').dataset.tab;
 const visualContent = document.getElementById('contentVisual').innerHTML;
 const htmlContent = document.getElementById('contentCode').value;
 const markdownContent = document.getElementById('contentMarkdown').value;
 const bbcodeContent = document.getElementById('contentBBCode').value;
 
 if (activeTab === 'visual') {
 document.getElementById('contentCode').value = visualContent;
 document.getElementById('contentMarkdown').value = htmlToMarkdown(visualContent);
 document.getElementById('contentBBCode').value = htmlToBBCode(visualContent);
 } else if (activeTab === 'html') {
 document.getElementById('contentVisual').innerHTML = htmlContent;
 document.getElementById('contentMarkdown').value = htmlToMarkdown(htmlContent);
 document.getElementById('contentBBCode').value = htmlToBBCode(htmlContent);
 } else if (activeTab === 'markdown') {
 const html = marked.parse(markdownContent);
 document.getElementById('contentVisual').innerHTML = html;
 document.getElementById('contentCode').value = html;
 document.getElementById('contentBBCode').value = htmlToBBCode(html);
 } else if (activeTab === 'bbcode') {
 const html = bbcodeToHtml(bbcodeContent);
 document.getElementById('contentVisual').innerHTML = html;
 document.getElementById('contentCode').value = html;
 document.getElementById('contentMarkdown').value = htmlToMarkdown(html);
 }
 }
 
 function updatePreview() {
 setTimeout(() => {
 syncContent();
 const content = document.getElementById('contentVisual').innerHTML;
 document.getElementById('preview').innerHTML = content;
 }, 100);
 }
 
 document.getElementById('contentCode').addEventListener('input', updatePreview);
 document.getElementById('contentMarkdown').addEventListener('input', updatePreview);
 document.getElementById('contentBBCode').addEventListener('input', updatePreview);
 
 // CONVERTERS (ОБНОВЛЕННЫЕ ДЛЯ ТАБЛИЦ И ЦИТАТ)
 function htmlToMarkdown(html) {
 let md = html;
 md = md.replace(/<h1[^>]*>(.*?)<\/h1>/gi, '# $1\n\n');
 md = md.replace(/<h2[^>]*>(.*?)<\/h2>/gi, '## $1\n\n');
 md = md.replace(/<h3[^>]*>(.*?)<\/h3>/gi, '### $1\n\n');
 md = md.replace(/<strong[^>]*>(.*?)<\/strong>/gi, '**$1**');
 md = md.replace(/<b[^>]*>(.*?)<\/b>/gi, '**$1**');
 md = md.replace(/<em[^>]*>(.*?)<\/em>/gi, '*$1*');
 md = md.replace(/<i[^>]*>(.*?)<\/i>/gi, '*$1*');
 md = md.replace(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/gi, '[$2]($1)');
 md = md.replace(/<img[^>]*src="([^"]*)"[^>]*>/gi, '![]($1)');
 md = md.replace(/<blockquote>(.*?)<\/blockquote>/gis, '> $1\n');
 md = md.replace(/<table[^>]*>.*?<\/table>/gis, '| Table content |\n');
 md = md.replace(/<p[^>]*>(.*?)<\/p>/gi, '$1\n\n');
 md = md.replace(/<br[^>]*>/gi, '\n');
 md = md.replace(/<[^>]+>/g, '');
 return md.trim();
 }
 
 function htmlToBBCode(html) {
 let bb = html;
 bb = bb.replace(/<strong[^>]*>(.*?)<\/strong>/gi, '[b]$1[/b]');
 bb = bb.replace(/<b[^>]*>(.*?)<\/b>/gi, '[b]$1[/b]');
 bb = bb.replace(/<em[^>]*>(.*?)<\/em>/gi, '[i]$1[/i]');
 bb = bb.replace(/<i[^>]*>(.*?)<\/i>/gi, '[i]$1[/i]');
 bb = bb.replace(/<u[^>]*>(.*?)<\/u>/gi, '[u]$1[/u]');
 bb = bb.replace(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/gi, '[url=$1]$2[/url]');
 bb = bb.replace(/<img[^>]*src="([^"]*)"[^>]*>/gi, '[img]$1[/img]');
 bb = bb.replace(/<blockquote>(.*?)<\/blockquote>/gis, '[quote]$1[/quote]');
 bb = bb.replace(/<table[^>]*>.*?<\/table>/gis, '[table]Table content[/table]');
 bb = bb.replace(/<h1[^>]*>(.*?)<\/h1>/gi, '[size=200]$1[/size]\n');
 bb = bb.replace(/<h2[^>]*>(.*?)<\/h2>/gi, '[size=150]$1[/size]\n');
 bb = bb.replace(/<p[^>]*>(.*?)<\/p>/gi, '$1\n\n');
 bb = bb.replace(/<br[^>]*>/gi, '\n');
 bb = bb.replace(/<[^>]+>/g, '');
 return bb.trim();
 }
 
 function bbcodeToHtml(bbcode) {
 let html = bbcode;
 html = html.replace(/\[b\](.*?)\[\/b\]/gi, '<strong>$1</strong>');
 html = html.replace(/\[i\](.*?)\[\/i\]/gi, '<em>$1</em>');
 html = html.replace(/\[u\](.*?)\[\/u\]/gi, '<u>$1</u>');
 html = html.replace(/\[url=(.*?)\](.*?)\[\/url\]/gi, '<a href="$1">$2</a>');
 html = html.replace(/\[url\](.*?)\[\/url\]/gi, '<a href="$1">$1</a>');
 html = html.replace(/\[img\](.*?)\[\/img\]/gi, '<img src="$1" alt="">');
 html = html.replace(/\[quote\](.*?)\[\/quote\]/gi, '<blockquote>$1</blockquote>');
 html = html.replace(/\[table\](.*?)\[\/table\]/gi, '<table><tr><td>$1</td></tr></table>');
 html = html.replace(/\[size=(\d+)\](.*?)\[\/size\]/gi, '<span style="font-size:$1%">$2</span>');
 html = html.replace(/\n/g, '<br>');
 return html;
 }

 // FORM SUBMISSION
 document.getElementById('blogForm').addEventListener('submit', async function(e) {
 e.preventDefault();
 
 const language = document.getElementById('language').value;
 const author = document.getElementById('author').value.trim();
 let slug = document.getElementById('slug').value.trim();
 const title = document.getElementById('title').value.trim();
 const description = document.getElementById('description').value.trim();
 
 syncContent();
 const content = document.getElementById('contentVisual').innerHTML;
 
 if (!language || !author || !slug || !title || !description || !content) {
 showError('Заполните все обязательные поля');
 return;
 }
 
 const formData = new FormData();
 formData.append('language', language);
 formData.append('author', author);
 formData.append('slug', slug);
 formData.append('title', title);
 formData.append('description', description);
 formData.append('content', content);
 
 try {
 const response = await fetch('publish.php', { method: 'POST', body: formData });
 const result = await response.json();
 
 if (result.success) {
 showSuccess(result);
 } else {
 showError(result.message);
 }
 } catch (error) {
 showError('Ошибка соединения: ' + error.message);
 }
 });

 function showSuccess(result) {
 const successMsg = document.getElementById('successMessage');
 const fileUrlDiv = successMsg.querySelector('.file-url');
 fileUrlDiv.innerHTML = `
 <strong>✅ Опубликовано!</strong><br>
 <a href="${result.url}" target="_blank">${result.url}</a><br><br>
 <strong>🌐 Язык:</strong> ${result.language}<br>
 <strong>👤 Кликните по имени автора</strong> чтобы увидеть все статьи
 `;
 successMsg.classList.add('show');
 document.getElementById('errorMessage').classList.remove('show');
 setTimeout(() => successMsg.classList.remove('show'), 10000);
 }
 
 function showError(message) {
 document.getElementById('errorText').textContent = message;
 document.getElementById('errorMessage').classList.add('show');
 document.getElementById('successMessage').classList.remove('show');
 setTimeout(() => document.getElementById('errorMessage').classList.remove('show'), 5000);
 }
 
 updatePreview();
 </script>
</body>
</html>